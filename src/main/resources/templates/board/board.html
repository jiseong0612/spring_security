<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<h1>board List</h1>
<ul>
	<li th:each="board : ${boardList}" th:text="|${board.bno}번_(${board.role}) >>> 작성자 : ${board.writer}, 제목 : ${board.title}|"></li>
</ul>
<hr>

<h1>board insert</h1>
<div>
	<form action="/insert" method="post">
		<h3>방명록을 작성해 보세요</h3>
		<input type="text" name="title" placeholder="title"><br>
		<input type="text" name="writer" placeholder="writer"><br>
		<input type="hidden" th:name = "${_csrf.parameterName}" th:value="${_csrf.token}" />
		<button>Submit_작성하기</button>
		<button id="ajaxBtn">Ajax_작성하기</button>
	</form>
</div>

<a href="javascript:void(0)">로그아웃하기</a>
<br>
<br>
<br>

<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script>
var csrf = '[[${_csrf.headerName}]]';
var csrfToken = '[[${_csrf.token}]]';

$(function(){
	$('#ajaxBtn').on('click', function(e){
		e.preventDefault();
		var data = {
			title : $('[name=title]').val(),
			writer : $('[name=writer]').val(),
		};
		
		$.ajax({
			url:'/insert',
			type : 'post',
			data : data,
			beforeSend : function(xhr){
				xhr.setRequestHeader(csrf, csrfToken);
			},
			success : function(){
				location.href="/board";
			},
			error : function(){
				alert('ee');
			}
		});
	});
	
	$('a').on('click', function(e){
		e.preventDefault();
		
		$('form').attr('action', '/logout').submit();
	});
});
</script>
</body>
</html>